<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Weather — OpenWeatherMap Demo</title>
  <style>
    :root{
      --bg:#0f1724; --card:#0b1220; --accent:#3b82f6; --muted:#94a3b8; --glass: rgba(255,255,255,0.03);
      --radius:14px; --shadow: 0 8px 24px rgba(2,6,23,0.6);
    }
    *{box-sizing:border-box}
    body{margin:0; font-family:Inter, ui-sans-serif, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; background: linear-gradient(180deg,#071025 0%, #0f1724 100%); color:#e6eef8; min-height:100vh; display:flex; align-items:center; justify-content:center; padding:32px}
    .app{width:100%; max-width:920px}
    header{display:flex; align-items:center; gap:12px; margin-bottom:18px}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,var(--accent),#06b6d4);display:flex;align-items:center;justify-content:center;font-weight:700;box-shadow:0 6px 18px rgba(59,130,246,0.18)}
    .title{font-size:20px;font-weight:600}
    .subtitle{font-size:12px;color:var(--muted)}
    .controls{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
    .search{display:flex;gap:8px;align-items:center;background:var(--glass);padding:8px;border-radius:12px;box-shadow:inset 0 1px 0 rgba(255,255,255,0.02)}
    .search input{background:transparent;border:0;color:inherit;outline:none;padding:8px 10px;width:260px;font-size:15px}
    .btn{background:linear-gradient(90deg,var(--accent),#06b6d4);border:none;color:#041129;padding:10px 14px;border-radius:10px;font-weight:600;cursor:pointer;box-shadow:var(--shadow)}
    .ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:9px 12px;border-radius:10px;color:var(--muted);cursor:pointer}
    .grid{display:grid;grid-template-columns:1fr 340px;gap:18px}
    @media (max-width:880px){.grid{grid-template-columns:1fr} .search input{width:160px}}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); padding:20px;border-radius:var(--radius); box-shadow:var(--shadow)}
    .weather-main{display:flex;align-items:center;gap:18px}
    .icon{width:120px;height:120px;border-radius:16px;background:rgba(255,255,255,0.03);display:flex;align-items:center;justify-content:center;font-size:48px}
    .meta{flex:1}
    .city{font-size:22px;font-weight:700}
    .temp{font-size:48px;font-weight:800;margin:6px 0}
    .desc{color:var(--muted);text-transform:capitalize}
    .stats{display:flex;gap:12px;margin-top:12px;flex-wrap:wrap}
    .stat{background:rgba(255,255,255,0.02);padding:10px 12px;border-radius:10px;min-width:110px}
    .stat small{display:block;color:var(--muted);font-size:12px}
    .stat strong{display:block;margin-top:6px;font-size:16px}
    .right{display:flex;flex-direction:column;gap:12px}
    .map-preview{height:160px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.04));display:flex;align-items:center;justify-content:center;color:var(--muted)}
    .history{display:flex;flex-direction:column;gap:8px}
    .history button{background:transparent;border-radius:8px;padding:8px 10px;border:1px dashed rgba(255,255,255,0.03);color:var(--muted);cursor:pointer;text-align:left}
    .notice{color:var(--muted);font-size:13px;margin-top:10px}
    .loading{width:28px;height:28px;border-radius:50%;border:3px solid rgba(255,255,255,0.06);border-top-color:var(--accent);animation:spin 1s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
    .error{background:#451417;color:#ffd8d8;padding:10px;border-radius:10px}
    footer{margin-top:14px;color:var(--muted);font-size:13px}
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="brand">
        <div class="logo">W</div>
        <div>
          <div class="title">Weather — OpenWeatherMap</div>
          <div class="subtitle">Real-time city search • JS + REST API</div>
        </div>
      </div>
    </header>
    <div class="controls">
      <div class="search card" style="display:flex;align-items:center">
        <input id="cityInput" placeholder="Enter city (e.g. Mumbai, London)" autocomplete="off" />
        <button id="searchBtn" class="btn">Search</button>
      </div>
      <button id="geoBtn" class="ghost">Use my location</button>
      <div style="margin-left:auto;display:flex;gap:8px;align-items:center">
        <div id="spinner" style="display:none"><div class="loading"></div></div>
      </div>
    </div>
    <main style="margin-top:16px">
      <div class="grid">
        <section class="card" id="weatherCard">
          <div id="errorBox" style="display:none" class="error"></div>
          <div id="emptyState" style="text-align:center;padding:36px;color:var(--muted)">
            <div style="font-size:48px;margin-bottom:12px">☁️</div>
            Type a city and press <strong>Search</strong> or use <strong>Use my location</strong>.
          </div>
          <div id="content" style="display:none">
            <div class="weather-main">
              <div class="icon" id="iconWrap"><img id="weatherIcon" alt="icon" width="96" height="96"/></div>
              <div class="meta">
                <div class="city" id="cityName">City, Country</div>
                <div class="temp" id="temp">--°C</div>
                <div class="desc" id="description">clear sky</div>
                <div class="notice" id="localTime">Local time: --:--</div>
              </div>
            </div>
            <div class="stats" style="margin-top:16px">
              <div class="stat">
                <small>Feels like</small>
                <strong id="feels">--°C</strong>
              </div>
              <div class="stat">
                <small>Humidity</small>
                <strong id="humidity">--%</strong>
              </div>
              <div class="stat">
                <small>Wind</small>
                <strong id="wind">-- m/s</strong>
              </div>
              <div class="stat">
                <small>Pressure</small>
                <strong id="pressure">-- hPa</strong>
              </div>
              <div class="stat">
                <small>Sunrise / Sunset</small>
                <strong id="sun">-- / --</strong>
              </div>
            </div>
          </div>
        </section>
        <aside class="right">
          <div class="card map-preview" id="mapPreview">Map preview</div>
          <div class="card history">
            <div style="font-weight:700;margin-bottom:8px">Recent searches</div>
            <div id="historyList"></div>
            <div style="margin-top:8px" class="notice">Click a recent city to quickly reload it. History saved locally.</div>
          </div>
        </aside>
      </div>
      <footer>
        Built with OpenWeatherMap API • Replace <code>API_KEY</code> in the script with your key.
      </footer>
    </main>
  </div>
  <script>
    const OWM_KEY = 'da06676de249bc7662fab538a191ab41';
    const $ = (sel) => document.querySelector(sel);
    const cityInput = $('#cityInput');
    const searchBtn = $('#searchBtn');
    const geoBtn = $('#geoBtn');
    const spinner = $('#spinner');
    const errorBox = $('#errorBox');
    const emptyState = $('#emptyState');
    const content = $('#content');
    const cityName = $('#cityName');
    const tempEl = $('#temp');
    const desc = $('#description');
    const localTime = $('#localTime');
    const weatherIcon = $('#weatherIcon');
    const feels = $('#feels');
    const humidity = $('#humidity');
    const wind = $('#wind');
    const pressure = $('#pressure');
    const sun = $('#sun');
    const mapPreview = $('#mapPreview');
    const historyList = $('#historyList');
    function showSpinner(){spinner.style.display='block'}
    function hideSpinner(){spinner.style.display='none'}
    function showError(msg){errorBox.style.display='block'; errorBox.textContent = msg}
    function hideError(){errorBox.style.display='none'; errorBox.textContent = ''}
    function getHistory(){ try{return JSON.parse(localStorage.getItem('weather_history')||'[]')}catch(e){return[]} }
    function pushHistory(city){let h=getHistory(); h = [city,...h.filter(x=>x.toLowerCase()!==city.toLowerCase())].slice(0,6); localStorage.setItem('weather_history',JSON.stringify(h)); renderHistory() }
    function renderHistory(){ const list=getHistory(); historyList.innerHTML=''; if(!list.length){historyList.innerHTML='<div style="color:var(--muted)">No recent searches</div>'; return} list.forEach(c=>{const btn=document.createElement('button');btn.textContent=c;btn.onclick=()=>fetchWeatherByCity(c);historyList.appendChild(btn)}) }
    renderHistory();
    async function fetchWeatherByCity(city){
      if(!city) return;
      hideError(); showSpinner();
      try{
        const url = `https://api.openweathermap.org/data/2.5/weather?q=${encodeURIComponent(city)}&units=metric&appid=${OWM_KEY}`;
        const res = await fetch(url);
        if(!res.ok){
          if(res.status===404) throw new Error('City not found. Check spelling.');
          throw new Error('Failed to fetch weather. HTTP ' + res.status);
        }
        const data = await res.json();
        renderWeather(data);
        pushHistory(data.name + (data.sys && data.sys.country ? ', ' + data.sys.country : ''));
      }catch(err){ showError(err.message) }
      finally{ hideSpinner() }
    }
    async function fetchWeatherByCoords(lat, lon){
      hideError(); showSpinner();
      try{
        const url = `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&units=metric&appid=${OWM_KEY}`;
        const res = await fetch(url);
        if(!res.ok) throw new Error('Failed to fetch weather for your location.');
        const data = await res.json();
        renderWeather(data);
        pushHistory(data.name + (data.sys && data.sys.country ? ', ' + data.sys.country : ''));
      }catch(err){ showError(err.message) }
      finally{ hideSpinner() }
    }
    function renderWeather(data){
      emptyState.style.display='none'; content.style.display='block'; hideError();
      const w = data.weather && data.weather[0];
      weatherIcon.src = w ? `https://openweathermap.org/img/wn/${w.icon}@4x.png` : '';
      weatherIcon.alt = w ? w.description : '';
      cityName.textContent = `${data.name}${data.sys && data.sys.country ? ', ' + data.sys.country : ''}`;
      tempEl.textContent = `${Math.round(data.main.temp)}°C`;
      desc.textContent = w ? w.description : '';
      feels.textContent = `${Math.round(data.main.feels_like)}°C`;
      humidity.textContent = `${data.main.humidity}%`;
      wind.textContent = `${data.wind.speed} m/s`;
      pressure.textContent = `${data.main.pressure} hPa`;
      const tz = data.timezone || 0;
      const sunrise = new Date((data.sys.sunrise + tz) * 1000);
      const sunset = new Date((data.sys.sunset + tz) * 1000);
      sun.textContent = `${pad(sunrise.getUTCHours())}:${pad(sunrise.getUTCMinutes())} / ${pad(sunset.getUTCHours())}:${pad(sunset.getUTCMinutes())}`;
      const nowUTC = Date.now();
      const local = new Date(nowUTC + tz * 1000);
      localTime.textContent = `Local time: ${pad(local.getUTCHours())}:${pad(local.getUTCMinutes())}`;
      if(data.coord){
        const lat = data.coord.lat, lon = data.coord.lon;
        mapPreview.innerHTML = `<iframe src="https://www.openstreetmap.org/export/embed.html?bbox=${lon-0.2}%2C${lat-0.1}%2C${lon+0.2}%2C${lat+0.1}&layer=mapnik&marker=${lat}%2C${lon}" style="width:100%;height:100%;border:0;border-radius:8px"></iframe>`;
      }
      if(w){
        const id = w.id;
        let bg = 'linear-gradient(180deg,#071025,#0f1724)';
        if(id >= 200 && id < 600) bg = 'linear-gradient(180deg,#0b3a56,#08212b)';
        else if(id >=600 && id <700) bg = 'linear-gradient(180deg,#0b2b3e,#001018)';
        else if(id >=700 && id <800) bg = 'linear-gradient(180deg,#3b3b3b,#0b0b0b)';
        else if(id === 800) bg = 'linear-gradient(180deg,#2b6cea,#60a5fa)';
        else if(id >800) bg = 'linear-gradient(180deg,#4b5563,#0b1220)';
        document.body.style.background = bg;
      }
    }
    function pad(n){return String(n).padStart(2,'0')}
    searchBtn.addEventListener('click', ()=>{ const val = cityInput.value.trim(); if(!val){ showError('Please type a city name.'); return } fetchWeatherByCity(val) })
    cityInput.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ searchBtn.click() } })
    geoBtn.addEventListener('click', ()=>{
      if(!navigator.geolocation){ showError('Geolocation not supported by your browser.'); return }
      showSpinner(); navigator.geolocation.getCurrentPosition((pos)=>{ fetchWeatherByCoords(pos.coords.latitude, pos.coords.longitude) }, (err)=>{ hideSpinner(); showError('Unable to get location: ' + err.message) }, {timeout:10000})
    })
    if(OWM_KEY === 'API_KEY'){
      showError('API key not set. Replace OWM_KEY in the script with your OpenWeatherMap API key. Visit [https://openweathermap.org](https://openweathermap.org) to sign up.');
    }
  </script>
</body>
</html>
